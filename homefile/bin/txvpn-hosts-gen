#!/bin/bash
set -eu

cat > /etc/hosts <<EOF
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by hosts-gen using templates
# from /etc/hosts.d
#

127.0.0.1       localhost dzjk
255.255.255.255 broadcasthost
::1             localhost
fe80::1%lo0     localhost

127.0.0.1         ridgemba

EOF

for f in $(ls /etc/hosts.d/commons); do
    path="/etc/hosts.d/commons/${f}"
    echo "### BEGIN ${f} ###" >> /etc/hosts
    grep -Ev '^\s*(#.*)?$' ${path} >> /etc/hosts || true
    echo -e "### END ${f} ###\n" >> /etc/hosts
done


for f in $(ls /etc/hosts.d/txvpn); do
    path="/etc/hosts.d/txvpn/${f}"
    echo "### BEGIN ${f} ###" >> /etc/hosts
    grep -Ev '^\s*(#.*)?$' ${path} >> /etc/hosts || true
    echo -e "### END ${f} ###\n" >> /etc/hosts
done
